{"version":3,"sources":["userscontroller.js"],"names":["userController","req","res","body","email","firstname","lastname","password","address","isadmin","joi","validate","Schema","userSchema","error","value","status","send","details","message","id","parseInt","users","length","token","authentication","encodeToken","userId","checkemail","find","oneusers","json","insertuser","push","user","params","oneuser","onePost","specificUser","verifySchema","getuser","updateuser"],"mappings":"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","file":"userscontroller.js","sourceRoot":"C:/Users/PIH/Documents/challenge/controller","sourcesContent":["// import passwordHash from 'password-hash';\nimport joi from 'joi';\nimport authentication from '../helpers/authentication';\nimport users from '../db/user';\nimport Schema from '../helpers/inputvalidation';\n\nclass userController {\n  static createUser(req, res) {\n    const {\n      email, firstname, lastname, password, address, isadmin,\n    } = req.body;\n    const { error, value } = joi.validate(\n      {\n        email,\n        firstname,\n        lastname,\n        password,\n        address,\n        isadmin,\n      },\n      Schema.userSchema,\n    );\n    if (error) {\n      res.status(400).send({ error: error.details[0].message });\n    } else {\n      // generate the id and pass it to a user\n      const id = parseInt(users.length) + 1;\n      const token = authentication.encodeToken({\n        email,\n        firstname,\n        lastname,\n        password,\n        address,\n        userId: id,\n        status: 'unverified',\n        isadmin,\n      });\n\n      const checkemail = users.find(oneusers => oneusers.email == req.body.email);\n      if (checkemail) {\n        return res.status(400).json({\n\n          message: 'email already exist please use another email!',\n        });\n      }\n      const insertuser = {\n        id,\n        email,\n        firstname,\n        lastname,\n        password,\n        address,\n        status: 'unverified',\n        isadmin,\n\n      };\n      users.push(insertuser);\n\n\n      res.status(201).send({\n        message: 'user registered successfully',\n        user: {\n          token,\n          id,\n          firstname,\n          lastname,\n          email,\n          isadmin,\n\n        },\n\n      });\n    }\n  }\n\n  static getuser(req, res) {\n    return res.json({\n      status: 200,\n      message: 'List of all users',\n      user: users,\n    });\n  }\n\n  // get user by id\n  static getOneuser(req, res) {\n    const { id } = req.params;\n    const user = users.find(oneuser => oneuser.id == id);\n    if (user) {\n      return res.status(200).json({\n        message: 'one user found',\n        onePost: user,\n      });\n    }\n    res.status(400).json({\n      error: 'no user found with that id',\n    });\n  }\n\n  // Login data processing\n  static login(req, res) {\n    const { email, password } = req.body;\n    const specificUser = users.find(oneuser => oneuser.email == email);\n    if (!specificUser) {\n      return res.status(400).json({\n\n        message: 'No user with that email !',\n      });\n    } if (specificUser) {\n      if (specificUser.password == password) {\n        const {\n          firstname, lastname, email, password, isadmin,\n        } = specificUser;\n        const user = {\n          firstname,\n          lastname,\n          email,\n          password,\n          status: specificUser.status,\n          isadmin: specificUser.isadmin,\n          id: specificUser.id,\n        };\n        const token = authentication.encodeToken(user);\n        res.status(200).send({\n          message: 'Logged in successfully',\n          token,\n          id: specificUser.id,\n          firstname,\n          lastname,\n          email,\n          status: specificUser.status,\n          isadmin,\n\n\n        });\n      } else {\n        res.status(400).send({ error: 'incorrect Password !' });\n      }\n    }\n  }\n\n  // update function (patch)\n  static verifyuser(req, res) {\n    const { email } = req.params;\n    const { status } = req.body;\n    const { error, value } = joi.validate(\n      {\n        status,\n      },\n      Schema.verifySchema,\n    );\n    if (error) {\n      res.status(400).send({ error: error.details[0].message });\n    } else {\n      const getuser = users.find(updateuser => updateuser.email == email);\n      if (getuser) {\n        (getuser.status = status);\n        return res.status(201).json({\n          status: 201,\n          message: 'user is verified succesfully',\n          user: getuser,\n        });\n      }\n      res.status(400).json({\n        status: 400,\n        error: \"can't find user with that email\",\n      });\n    }\n  }\n}\n\n\nexport default userController;\n"]}