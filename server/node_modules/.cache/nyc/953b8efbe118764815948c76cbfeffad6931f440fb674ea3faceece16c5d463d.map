{"version":3,"sources":["authentication.js"],"names":["encodeToken","user","payload","expiration","add","unix","iat","sub","token","jwt","encode","decodeToken","decoded","decode","accessTokenRequired","req","res","next","headers","undefined","status","send","error","now","decodedToken","body","userId","isadmin","adminTokenRequired","console","log"],"mappings":";;;;;;AAAA;;;;AACA;;;;;;AAGA,IAAMA,cAAc,SAAdA,WAAc,CAACC,IAAD,EAAU;AAC5B,MAAMC,UAAU;AACdC,gBAAY,wBACTC,GADS,CACL,CADK,EACF,MADE,EAETC,IAFS,EADE;AAIdC,SAAK,wBAASD,IAAT,EAJS;AAKdE,SAAKN;AALS,GAAhB;AAOA,MAAMO,QAAQC,oBAAIC,MAAJ,CAAWR,OAAX,EAAoB,QAApB,CAAd;AACA,SAAOM,KAAP;AACD,CAVD;;AAYA,IAAMG,cAAc,SAAdA,WAAc,CAACH,KAAD,EAAW;AAC7B,MAAMI,UAAUH,oBAAII,MAAJ,CAAWL,KAAX,EAAkB,QAAlB,CAAhB;AACA,SAAOI,OAAP;AACD,CAHD;AAIA;AACA,IAAME,sBAAsB,SAAtBA,mBAAsB,CAACC,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AAAA,MACtCT,KADsC,GAC5BO,IAAIG,OADwB,CACtCV,KADsC;;AAE9C,MAAIA,SAASW,SAAT,IAAsBX,SAAS,IAAnC,EAAyC;AACvCQ,QAAII,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAAEC,OAAO,6BAAT,EAArB;AACD,GAFD,MAEO;AACL,QAAMC,MAAM,wBAASlB,IAAT,EAAZ;AACA,QAAMmB,eAAeb,YAAYH,KAAZ,CAArB;AACA,QAAIe,MAAMC,aAAarB,UAAvB,EAAmC;AACjCa,UAAII,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAAEC,OAAO,eAAT,EAArB;AACD,KAFD,MAEO;AACLP,UAAIU,IAAJ,CAASC,MAAT,GAAkBF,aAAajB,GAAb,CAAiBmB,MAAnC;AACAX,UAAIU,IAAJ,CAASE,OAAT,GAAmBH,aAAajB,GAAb,CAAiBoB,OAApC;AACAV;AACD;AACF;AACF,CAfD;;AAiBA,IAAMW,qBAAqB,SAArBA,kBAAqB,CAACb,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AAC7C,MAAMT,QAAQO,IAAIG,OAAJ,CAAYV,KAA1B;AACAqB,UAAQC,GAAR,CAAYtB,KAAZ;AACA,MAAIA,SAASW,SAAb,EAAwB;AACtB,QAAMI,MAAM,wBAASlB,IAAT,EAAZ;AACA,QAAMmB,eAAeb,YAAYH,KAAZ,CAArB;AACA,QAAIe,MAAMC,aAAarB,UAAvB,EAAmC;AACjCa,UAAII,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAAEC,OAAO,eAAT,EAArB;AACD,KAFD,MAEO;AACLP,UAAIU,IAAJ,CAASC,MAAT,GAAkBF,aAAajB,GAAb,CAAiBmB,MAAnC;AACAX,UAAIU,IAAJ,CAASE,OAAT,GAAmBH,aAAajB,GAAb,CAAiBoB,OAApC;AACA,UAAIH,aAAajB,GAAb,CAAiBoB,OAAjB,IAA4B,IAAhC,EAAsC;AACpCV;AACD,OAFD,MAEO;AACLD,YAAII,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAAEC,OAAO,6BAAT,EAArB;AACD;AACF;AACF,GAdD,MAcO;AACLN,QAAII,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAAEC,OAAO,+BAAT,EAArB;AACD;AACF,CApBD;kBAqBe,EAAER,wCAAF,EAAuBd,wBAAvB,EAAoC4B,sCAApC,E","file":"authentication.js","sourceRoot":"C:/Users/PIH/Documents/challenge/helpers","sourcesContent":["import jwt from 'jwt-simple';\r\nimport moment from 'moment';\r\n\r\n\r\nconst encodeToken = (user) => {\r\n  const payload = {\r\n    expiration: moment()\r\n      .add(2, 'hour')\r\n      .unix(),\r\n    iat: moment().unix(),\r\n    sub: user,\r\n  };\r\n  const token = jwt.encode(payload, 'secret');\r\n  return token;\r\n};\r\n\r\nconst decodeToken = (token) => {\r\n  const decoded = jwt.decode(token, 'secret');\r\n  return decoded;\r\n};\r\n// Access token required for a user\r\nconst accessTokenRequired = (req, res, next) => {\r\n  const { token } = req.headers;\r\n  if (token == undefined || token == null) {\r\n    res.status(400).send({ error: 'Not authorized to this page' });\r\n  } else {\r\n    const now = moment().unix();\r\n    const decodedToken = decodeToken(token);\r\n    if (now > decodedToken.expiration) {\r\n      res.status(400).send({ error: 'Token expired' });\r\n    } else {\r\n      req.body.userId = decodedToken.sub.userId;\r\n      req.body.isadmin = decodedToken.sub.isadmin;\r\n      next();\r\n    }\r\n  }\r\n};\r\n\r\nconst adminTokenRequired = (req, res, next) => {\r\n  const token = req.headers.token;\r\n  console.log(token)\r\n  if (token != undefined) {\r\n    const now = moment().unix();\r\n    const decodedToken = decodeToken(token);\r\n    if (now > decodedToken.expiration) {\r\n      res.status(400).send({ error: 'Token expired' });\r\n    } else {\r\n      req.body.userId = decodedToken.sub.userId;\r\n      req.body.isadmin = decodedToken.sub.isadmin;\r\n      if (decodedToken.sub.isadmin == true) {\r\n        next();\r\n      } else {\r\n        res.status(403).send({ error: 'Not authorized to this page' });\r\n      }\r\n    }\r\n  } else {\r\n    res.status(400).send({ error: 'error authorized to this page' });\r\n  }\r\n};\r\nexport default { accessTokenRequired, encodeToken, adminTokenRequired };"]}